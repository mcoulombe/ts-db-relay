services:
  ts-db-relay:
    build:
      dockerfile: Dockerfile
    container_name: ts-db-relay
    environment:
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=Test4Sk8board
      - POSTGRES_DB=testdb
      - TS_AUTHKEY=$TS_AUTHKEY
      - TS_SERVER=$TS_SERVER
      - TSNET_FORCE_LOGIN=1
    volumes:
      - ../data/postgres:/var/lib/postgresql/data
      - ../data/ts-state:/var/lib/ts-state
      - ../data/ts-dummy-state:/var/lib/ts-dummy-state
      - ../data/certs:/var/lib/certs
      - ../data/creds:/var/lib/creds
      - ../data/audits:/var/lib/audits
      - ../cmd/ts-db-relay.exe:/usr/local/bin/ts-db-relay
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    stdin_open: true
    tty: true
